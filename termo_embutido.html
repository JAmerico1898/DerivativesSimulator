<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Derivativo Embutido: Termo de Moeda</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; font-family: 'Segoe UI', sans-serif; }
        .transition-bar { transition: height 0.5s cubic-bezier(0.4, 0, 0.2, 1), background-color 0.3s; }
        .turbine-blade { animation: spin 4s infinite linear; transform-origin: center; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        
        /* Slider Customizado */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            margin-top: -8px;
            box-shadow: 0 0 10px rgba(59,130,246,0.5);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #475569;
            border-radius: 2px;
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">

    <div class="max-w-4xl w-full bg-slate-900 rounded-xl border border-slate-700 shadow-2xl overflow-hidden">
        
        <!-- Header -->
        <header class="bg-slate-800 p-6 border-b border-slate-700 text-center">
            <h1 class="text-2xl font-bold text-white mb-2">Visualizando o Derivativo Embutido</h1>
            <p class="text-slate-400 text-sm">Contrato Anfitrião (Aluguel) + Termo de Moeda (Variação Dólar)</p>
        </header>

        <div class="p-8 grid grid-cols-1 md:grid-cols-2 gap-8">
            
            <!-- Coluna Esquerda: O Cenário Físico -->
            <div class="flex flex-col gap-6">
                
                <!-- Entidades -->
                <div class="relative h-48 bg-slate-800 rounded-lg border border-slate-600 p-4 flex justify-between items-center">
                    
                    <!-- Empresa BR -->
                    <div class="flex flex-col items-center z-10">
                        <div class="w-16 h-16 bg-blue-900 rounded-lg border-2 border-blue-500 flex items-center justify-center mb-2">
                            <i data-lucide="building-2" class="text-blue-400 w-8 h-8"></i>
                        </div>
                        <span class="text-xs font-bold text-blue-400">Energia BR S.A.</span>
                        <span class="text-[10px] text-slate-500">Locatária</span>
                    </div>

                    <!-- Fluxo -->
                    <div class="flex-1 px-4 flex flex-col items-center">
                        <span class="text-[10px] text-slate-400 mb-1">Pagamento Mensal</span>
                        <div class="w-full h-1 bg-slate-700 relative">
                            <i data-lucide="arrow-right" class="absolute -right-1 -top-1.5 w-4 h-4 text-slate-500"></i>
                            <!-- Particula de dinheiro -->
                            <div id="money-particle" class="absolute top-1/2 left-0 w-3 h-3 bg-green-500 rounded-full -translate-y-1/2 shadow-lg shadow-green-500/50 transition-all duration-300"></div>
                        </div>
                    </div>

                    <!-- Empresa EUA -->
                    <div class="flex flex-col items-center z-10">
                        <div class="w-16 h-16 bg-indigo-900 rounded-lg border-2 border-indigo-500 flex items-center justify-center mb-2 overflow-hidden relative">
                            <!-- Turbina Icon Animado -->
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-10 h-10 text-indigo-400 turbine-blade absolute">
                                <path d="M12 12c0-3 2.5-5 5-5 1.5 0 3 .8 3 3s-1.5 3-3 3c-2.5 0-5-2-5 1z" />
                                <path d="M12 12c-3 0-5 2.5-5 5 0 1.5.8 3 3 3s3-1.5 3-3c0-2.5-2-5 1-5z" />
                                <path d="M12 12c0 3-2.5 5-5 5-1.5 0-3-.8-3-3s1.5-3 3-3c2.5 0 5 2 5-1z" />
                            </svg>
                        </div>
                        <span class="text-xs font-bold text-indigo-400">USA Turbines Inc.</span>
                        <span class="text-[10px] text-slate-500">Locadora</span>
                    </div>
                </div>

                <!-- Controle do Dólar -->
                <div class="bg-slate-800 p-4 rounded-lg border border-slate-600">
                    <div class="flex justify-between items-center mb-4">
                        <label class="font-bold text-slate-300 flex items-center gap-2">
                            <i data-lucide="dollar-sign" class="w-4 h-4 text-green-500"></i> Cotação USD/BRL
                        </label>
                        <span id="rate-display" class="bg-slate-900 px-3 py-1 rounded text-green-400 font-mono font-bold">R$ 5.00</span>
                    </div>
                    <input type="range" id="usd-slider" min="3.00" max="8.00" step="0.10" value="5.00">
                    <div class="flex justify-between text-[10px] text-slate-500 mt-2">
                        <span>R$ 3.00 (Dólar Baixo)</span>
                        <span>R$ 5.00 (Base do Contrato)</span>
                        <span>R$ 8.00 (Crise Cambial)</span>
                    </div>
                </div>

            </div>

            <!-- Coluna Direita: O "Passageiro Clandestino" (Gráfico) -->
            <div class="bg-slate-800 p-6 rounded-lg border border-slate-600 flex flex-col items-center justify-end relative">
                
                <h3 class="absolute top-4 left-4 font-bold text-white text-sm">Composição do Pagamento (Reais)</h3>

                <!-- Container das Barras -->
                <div class="w-full flex items-end justify-center gap-4 h-64 mt-8">
                    
                    <!-- Barra 1: Contrato Original -->
                    <div class="w-24 flex flex-col items-center">
                        <div class="text-xs text-slate-400 mb-1">Contrato Base</div>
                        <div class="w-full bg-blue-600 rounded-t shadow-[0_0_15px_rgba(37,99,235,0.3)] flex items-end justify-center text-white font-bold text-sm pb-2" style="height: 150px;">
                            R$ 500k
                        </div>
                        <div class="text-[10px] text-slate-500 mt-2 text-center">Valor Fixo Acordado</div>
                    </div>

                    <!-- Sinal de Mais -->
                    <div class="text-slate-500 font-bold text-xl mb-16">+</div>

                    <!-- Barra 2: O Derivativo (Passageiro) -->
                    <div class="w-24 flex flex-col items-center relative">
                        <!-- Label Flutuante de Perda/Ganho -->
                        <div id="derivative-label" class="absolute -top-8 text-xs font-bold text-slate-300 opacity-0 transition-opacity">0</div>
                        
                        <div id="passenger-text" class="text-xs text-red-400 mb-1">Passageiro (FX)</div>
                        <div id="derivative-bar" class="w-full bg-red-500/80 rounded-t shadow-[0_0_15px_rgba(239,68,68,0.3)] transition-bar flex items-end justify-center text-white font-bold text-xs pb-1 border-t border-red-400" style="height: 0px;">
                        </div>
                        <div class="text-[10px] text-slate-500 mt-2 text-center">Variação Cambial</div>
                    </div>

                    <!-- Sinal de Igual -->
                    <div class="text-slate-500 font-bold text-xl mb-16">=</div>

                    <!-- Barra 3: Total -->
                    <div class="w-24 flex flex-col items-center">
                        <div class="text-xs text-white mb-1">Total Pago</div>
                        <div id="total-bar" class="w-full bg-slate-600 rounded-t transition-bar flex items-end justify-center text-white font-bold text-sm pb-2 relative overflow-hidden" style="height: 150px;">
                            <!-- Pattern overlay -->
                            <div class="absolute inset-0 opacity-20 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNCIgaGVpZ2h0PSI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik0xIDNoMXYxHDF6IiBmaWxsPSIjZmZmIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=')]"></div>
                            <span id="total-value" class="z-10">R$ 500k</span>
                        </div>
                    </div>

                </div>

                <!-- Explanation Box -->
                <div id="explanation-box" class="w-full mt-6 p-3 bg-slate-900/50 rounded border border-slate-700 text-xs text-slate-300">
                    O dólar está no preço base do contrato (R$ 5.00). O derivativo está zerado.
                </div>

            </div>
        </div>

    </div>

    <script>
        lucide.createIcons();

        // Configurações do Contrato
        const BASE_RATE = 5.00;
        const BASE_RENT = 500000;
        const PIXELS_PER_RL = 150 / 500000; // Escala gráfica

        // Elementos DOM
        const slider = document.getElementById('usd-slider');
        const rateDisplay = document.getElementById('rate-display');
        const derivativeBar = document.getElementById('derivative-bar');
        const derivativeLabel = document.getElementById('derivative-label');
        const totalBar = document.getElementById('total-bar');
        const totalValue = document.getElementById('total-value');
        const explanationBox = document.getElementById('explanation-box');
        const moneyParticle = document.getElementById('money-particle');
        const passengerText = document.getElementById('passenger-text');

        // Formatação Moeda
        const fmt = (val) => val.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL', maximumFractionDigits: 0 });

        function updateSimulation() {
            const currentRate = parseFloat(slider.value);
            rateDisplay.innerText = currentRate.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

            // Cálculo do "Forward Embutido"
            // A diferença entre a taxa atual e a base é o impacto do derivativo
            const variationRatio = (currentRate - BASE_RATE) / BASE_RATE;
            const derivativeImpact = BASE_RENT * variationRatio;
            const totalRent = BASE_RENT + derivativeImpact;

            // Atualiza Gráficos
            const derivativeHeight = Math.abs(derivativeImpact) * PIXELS_PER_RL;
            const totalHeight = totalRent * PIXELS_PER_RL; // A altura total ajustada pode quebrar o layout se for muito alta, vamos limitar visualmente ou usar escala relativa
            
            // Reajuste de escala visual para não estourar o container
            // Vamos fixar a base em 100px e variar o resto proporcionalmente
            const basePx = 100;
            const impactPx = (derivativeImpact / BASE_RENT) * basePx;
            
            derivativeBar.style.height = `${Math.abs(impactPx)}px`;
            totalBar.style.height = `${basePx + impactPx}px`;
            
            // Cores baseadas em Ganho/Perda (Se o dólar cair, o aluguel fica mais barato = ganho para BR)
// 1. Limpeza: Removemos TODAS as cores (vermelho original, vermelho novo e verde)
            derivativeBar.classList.remove('bg-red-500/80', 'bg-red-500', 'border-red-400', 'shadow-[0_0_15px_rgba(239,68,68,0.3)]');
            derivativeBar.classList.remove('bg-green-500', 'border-green-400', 'shadow-[0_0_15px_rgba(34,197,94,0.3)]');
            
            // Limpeza do Texto "Passageiro (FX)"
            passengerText.classList.remove('text-red-400', 'text-green-400');

            // 2. Aplicação da nova cor
            if (derivativeImpact >= 0) {
                // Cenário de Custo (Vermelho)
                derivativeBar.classList.add('bg-red-500', 'border-red-400', 'shadow-[0_0_15px_rgba(239,68,68,0.3)]');
                
                passengerText.classList.add('text-red-400');
                
                derivativeLabel.classList.remove('text-green-400');
                derivativeLabel.classList.add('text-red-400');
                moneyParticle.style.backgroundColor = "#ef4444"; 
            } else {
                // Cenário de Ganho (Verde)
                derivativeBar.classList.add('bg-green-500', 'border-green-400', 'shadow-[0_0_15px_rgba(34,197,94,0.3)]');
                
                passengerText.classList.add('text-green-400');
                
                derivativeLabel.classList.remove('text-red-400');
                derivativeLabel.classList.add('text-green-400');
                moneyParticle.style.backgroundColor = "#22c55e";
            }
                        
            // Textos
            derivativeLabel.innerText = (derivativeImpact > 0 ? "+" : "") + fmt(derivativeImpact);
            derivativeLabel.style.opacity = Math.abs(derivativeImpact) > 1000 ? 1 : 0;
            totalValue.innerText = fmt(totalRent);

            // Explicação Dinâmica
            if (currentRate === BASE_RATE) {
                explanationBox.innerHTML = `Dólar estável em <strong>R$ 5,00</strong>. O derivativo embutido não tem efeito. O contrato segue seu valor nominal.`;
                explanationBox.className = "w-full mt-6 p-3 bg-slate-900/50 rounded border border-slate-700 text-xs text-slate-300";
            } else if (currentRate > BASE_RATE) {
                explanationBox.innerHTML = `Dólar subiu para <strong>R$ ${currentRate.toFixed(2)}</strong>. <br>O "passageiro clandestino" acordou: A empresa paga <span class="text-red-400 font-bold">${fmt(derivativeImpact)}</span> a mais apenas pela variação cambial.`;
                explanationBox.className = "w-full mt-6 p-3 bg-red-900/20 rounded border border-red-900 text-xs text-slate-300";
            } else {
                explanationBox.innerHTML = `Dólar caiu para <strong>R$ ${currentRate.toFixed(2)}</strong>. <br>O derivativo gerou um ganho financeiro: O aluguel ficou <span class="text-green-400 font-bold">${fmt(Math.abs(derivativeImpact))}</span> mais barato.`;
                explanationBox.className = "w-full mt-6 p-3 bg-green-900/20 rounded border border-green-900 text-xs text-slate-300";
            }
        }

        // Animação da partícula de dinheiro
        function animateParticle() {
            const width = document.querySelector('.w-full.h-1.bg-slate-700').offsetWidth;
            moneyParticle.style.left = "0px";
            moneyParticle.style.opacity = 1;
            
            setTimeout(() => {
                moneyParticle.style.left = width + "px";
            }, 50);

            setTimeout(() => {
                moneyParticle.style.opacity = 0;
            }, 900);
        }

        slider.addEventListener('input', updateSimulation);
        setInterval(animateParticle, 1500); // Loop da animação do dinheiro

        // Inicializa
        updateSimulation();

    </script>
</body>
</html>